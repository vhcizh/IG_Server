<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>전국 무더위 쉼터</title>
    <link rel="stylesheet" th:href="@{/common/css/shelters.css}" />
</head>
<body>

    <div th:replace="common/header :: header"></div>

    <main>
        <h2>전국 무더위 쉼터</h2>

        <form id="filterForm" method="get" action="/common/shelters" th:object="${searchDto}">
            <!-- 필터링 섹션 -->
            <div class="filter">
                <select id="city" th:field="*{city}" onchange="loadGus()">
                    <option value="">시 선택</option>
                </select>

                <select id="gu" th:field="*{gu}">
                    <option value="">구 선택</option>
                </select>

                <select id="facilityType" name="facilityType" th:field="*{facilityType}">
                    <option value="">시설 유형 선택</option>
                </select>

                <label>
                    시설명: <input type="text" name="shelterName" th:field="*{shelterName}">
                </label>
            </div>

            <div class="filter">
                <label class="checkbox-btn">
                    <input type="checkbox" name="isOpenAtNight" th:field="*{isOpenAtNight}"> 숙박가능
                </label>
                <label class="checkbox-btn">
                    <input type="checkbox" name="allowsAccommodation" th:field="*{allowsAccommodation}"> 야간개방
                </label>
                <label class="checkbox-btn">
                    <input type="checkbox" name="isOpenOnHolidays" th:field="*{isOpenOnHolidays}"> 휴일개방
                </label>
            </div>

            <div class="filter">
                <label for="sortOrder">정렬:</label>
                <select id="sortOrder" name="sortBy" th:field="*{sortBy}">
                    <option value="distance" th:selected="${searchDto.sortBy == 'distance'}">가까운순</option>
                    <option value="name" th:selected="${searchDto.sortBy == 'name'}">이름순</option>
                    <option value="currentUsage" th:selected="${searchDto.sortBy == 'currentUsage'}">현재 이용 인원 적은 순</option>
                </select>
            </div>

            <input type="hidden" name="page" value="1" th:field="*{page}">
            <input type="hidden" name="size" value="10" th:field="*{size}">

            <button type="submit">검색</button>
        </form>


        <!-- 쉼터 리스트 -->
        <div class="shelter_list">
            <ul>
                <li>쉼터명칭, 현재 이용인원, 거리</li>
                <li th:each="shelter : ${shelters}" class="shelter">
                    <a th:href="@{/common/shelters/${shelter.shelterId}}">
                        <span th:text="${shelter.shelterName}"></span>
                        <span th:text="${shelter.capacity}"></span>
                        <span th:text="${shelter.distance}"></span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- 페이징 버튼 -->
        <div class="pagination" th:if="${page.totalPages > 0}">
            <!-- 첫 페이지로 이동 -->
            <span>
                <a th:href="@{${request.requestURI}(page=1, size=${page.size})}"
                   th:class="${page.number == 0} ? 'disabled' : ''">
                    &lt;&lt;
                </a>
            </span>

            <!-- 이전 10페이지 -->
            <span>
                <a th:href="@{${request.requestURI}(page=${(page.number / 10) * 10}, size=${page.size})}"
                   th:class="${page.number < 10} ? 'disabled' : ''">
                    &lt;
                </a>
            </span>

            <!-- 페이지 번호 -->
            <span th:each="pageNum : ${#numbers.sequence((page.number / 10) * 10 + 1, T(java.lang.Math).min((page.number / 10) * 10 + 10, page.totalPages))}">
                <a th:href="@{${request.requestURI}(page=${pageNum}, size=${page.size})}"
                   th:text="${pageNum}"
                   th:class="${pageNum == page.number + 1} ? 'active' : ''">
                </a>
            </span>

            <!-- 다음 10페이지 -->
            <span>
                <a th:href="@{${request.requestURI}(page=${((page.number / 10) * 10) + 11}, size=${page.size})}"
                   th:class="${((page.number / 10) * 10) + 11 > page.totalPages} ? 'disabled' : ''">
                    &gt;
                </a>
            </span>

            <!-- 마지막 페이지로 이동 -->
            <span>
                <a th:href="@{${request.requestURI}(page=${page.totalPages}, size=${page.size})}"
                   th:class="${page.number + 1 == page.totalPages} ? 'disabled' : ''">
                    &gt;&gt;
                </a>
            </span>
        </div>

    </main>

    <div th:replace="common/footer :: footer"></div>
    <script th:src="@{/common/js/shelters.js}"></script>
</body>
</html>